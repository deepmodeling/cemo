import torch
from cemo.tk.transform import rotate_images
from pytest import approx


def test():
    angle = 0.0
    x_in = torch.tensor(
        [[[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.2500, 0.5000, 0.5000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.2500, 0.5000, 0.5000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000]]])
    x_out = rotate_images(
        x_in,
        angle,
        align_corners=False)
    x_expect = torch.tensor(
        [[[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.2500, 0.5000, 0.5000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000]],

        [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
         [0.0000, 0.0000, 0.2500, 0.5000, 0.5000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000],
         [0.0000, 0.0000, 0.5000, 1.0000, 1.0000]]])
    print(x_out)
    assert x_out == approx(x_expect)
